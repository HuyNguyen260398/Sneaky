{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% block content %}

  {% if not billing_profile %}

    <section class="ftco-section contact-section bg-light">
      <div class="container">
        <div class="row block-9">
          <div class="col-md-5 d-flex">
            {% include 'accounts/snippets/login-form.html' with form=login_form next_url=request.build.absolute_uri %}
          </div>
          <div class="col-md-2 d-flex justify-content-center">
            <h3>OR</h3>
          </div>
          <div class="col-md-5 d-flex">
            {% url "guest_register" as guest_register_url %}
            {% include 'accounts/snippets/guest-form.html' with form=guest_form next_url=request.build.absolute_uri action_url=guest_register_url %}
          </div>
        </div>
      </div>
    </section>

  {% else %}

    {% if not object.shipping_address %}

      <section class="ftco-section">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-xl-8 ftco-animate">
              {% url "checkout_address_create" as checkout_address_create %}
              {% include 'addresses/form.html' with form=address_form next_url=request.build.absolute_uri action_url=checkout_address_create address_type='shipping' %}
            </div> <!-- .col-md-8 -->
            <div class="col-xl-4 ftco-animate">
              {% url "checkout_address_reuse" as checkout_address_reuse %}
              {% include 'addresses/prev-addresses.html' with address_qs=address_qs next_url=request.build.absolute_uri address_type='shipping' action_url=checkout_address_reuse %}
            </div>
          </div>
        </div>
      </section>

    {% elif not object.billing_address %}

      <section class="ftco-section">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-xl-8 ftco-animate">
              {% url "checkout_address_create" as checkout_address_create %}
              {% include 'addresses/form.html' with form=address_form next_url=request.build.absolute_uri action_url=checkout_address_create address_type='billing' %}
            </div> <!-- .col-md-8 -->
            <div class="col-xl-4 ftco-animate">
              {% url "checkout_address_reuse" as checkout_address_reuse %}
              {% include 'addresses/prev-addresses.html' with address_qs=address_qs next_url=request.build.absolute_uri address_type='billing' action_url=checkout_address_reuse %}
            </div>
          </div>
        </div>
      </section>

    {% else %}

      {% if not has_card %}

        <section class="ftco-section">
          <div class="container">
            <div class="row justify-content-center">
              <div class="col-xl-8 ftco-animate">
                <div class="stripe-payment-form" data-token='{{ publish_key }}' data-next-url='{{ request.build_absolute_uri }}' data-btn-title='Add Payment Method'></div>
              </div> <!-- .col-md-8 -->
            </div>
          </div>
        </section>

        <!-- <div class='col-10 col-md-6 mx-auto'>
          <div class="stripe-payment-form" data-token='{{ publish_key }}' data-next-url='{{ request.build_absolute_uri }}' data-btn-title='Add Payment Method'></div>
        </div> -->

      {% else %}

        <h1>Finalize Checkout</h1>

      {% endif %}

    {% endif %}

  {% endif %}

{% endblock %}
